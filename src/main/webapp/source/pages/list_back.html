
<!DOCTYPE html>
<html>
<head>
<title>文件查询</title>
<script type="text/javascript" src="../../source/mvc/lib/cui.js"></script>
<script type="text/javascript" src="../../source/mvc/config/config.js"></script>
<script type="text/javascript" src="../../source/mvc/page/page.js"></script>
<link href="../../source/mvc/page/page.css" rel="stylesheet" />

<!-- Page CSS -->
<link href="../../source/mvc/assets/style.css" rel="stylesheet" />
<link href="../../source/mvc/assets/common.css" rel="stylesheet" />
<link href="../../source/mvc/assets/add-ons.min.css" rel="stylesheet" />


<!-- Vendor JS-->				
<script src="../../source/mvc/assets/vendor/js/jquery.min.js"></script>
<script src="../../source/mvc/assets/vendor/js/jquery-2.1.1.min.js"></script>
<script src="../../source/mvc/assets/vendor/js/jquery-migrate-1.2.1.min.js"></script>
<script src="../../source/mvc/assets/vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Vendor CSS-->
<link href="../../source/mvc/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="../../source/mvc/assets/vendor/skycons/css/skycons.css" rel="stylesheet" />
<link href="../../source/mvc/assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="../../source/mvc/assets/vendor/css/pace.preloader.css" rel="stylesheet" />
						
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
		<!-- Start: Header -->
		<div class="navbar" role="navigation">
			<div class="container-fluid container-nav">
				<!-- Navbar Right -->
				<div class="navbar-right">					

					<!-- Userbox -->
					<div class="userbox">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<figure class="profile-picture hidden-xs">
								<img src="assets/img/avatar.jpg" class="img-circle" alt="" />
							</figure>
							<div class="profile-info">
								<span class="name">150****7208</span>

							</div>			
							<i class="fa custom-caret"></i>
						</a>
						<div class="dropdown-menu">
							<ul class="list-unstyled">
								<li class="dropdown-menu-header bk-bg-white bk-margin-top-15">						
									<div class="progress progress-xs  progress-striped active">
										<div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
											60%
										</div>
									</div>							
								</li>	
								<li>
									<a href="javascript:void(0);"><i class="fa fa-user"></i> 我的账户</a>
								</li>
								<li>
									<a href="javascript:void(0);"><i class="fa fa-wrench"></i>重置密码</a>
								</li>

								<li>
									<a href="javascript:void(0);"><i class="fa fa-power-off"></i>退出</a>
								</li>
							</ul>
						</div>						
					</div>
					<!-- End Userbox -->
				</div>
				<!-- End Navbar Right -->
			</div>		
		</div>
		<!-- End: Header -->
		<!-- Start: Content -->
		<div class="container-fluid content">	
			<div class="row">
				<!-- Sidebar -->
				<div class="sidebar">
					<div class="sidebar-collapse">
						<!-- Sidebar Header Logo-->
						<div class="sidebar-header">
							<img src="assets/img/logo.png" class="img-responsive" alt="" />
						</div>
						<!-- Sidebar Menu-->
						<div class="sidebar-menu">						
							<nav id="menu" class="nav-main" role="navigation">
								<ul class="nav nav-sidebar" >
									<div class="panel-body text-center">
										<div class="flag">
											<!--<img src="assets/img/flags/USA.png" class="img-flags" alt="" />-->
										</div>
									</div>
									<li class="active">
										<a href="javascript:void(0);">
											<i class="fa fa-laptop" aria-hidden="true"></i><span> 消息管理</span>
										</a>
									</li>
									<li class="nav-parent">
										<a href="javascript:void(0);">
											<i class="fa fa-copy" aria-hidden="true"></i><span> 用户管理</span>
										</a>
										<ul class="nav nav-children">
											<li><a href="javascript:void(0);" data-toggle="tab"><span class="text"> 创建/编辑用户</span></a></li>
											<li><a href="javascript:void(0);" data-toggle="tab"><span class="text"> 查看</span></a></li>
										</ul>
									</li>
									<li class="nav-parent">
										<a href="javascript:void(0);">
											<i class="fa fa-tasks" aria-hidden="true"></i><span> 授权管理</span>
										</a>
										<ul class="nav nav-children">
											<li><a href="javascript:void(0);"><span class="text"> 菜单管理</span></a></li>
											<li><a href="javascript:void(0);"><span class="text"> 角色管理</span></a></li>
											<li><a href="javascript:void(0);"><span class="text"> 操作日志</span></a></li>

										</ul>
									</li>
									<li class="nav-parent">
										<a href="../pages/target.html">
											<i class="fa fa-table" aria-hidden="true"></i><span> 文档类别管理</span>
										</a>
									</li>
									<li class="nav-parent">
										<a href="../pages/list.html">
											<i class="fa fa-table" aria-hidden="true"></i><span> 文档管理</span>
										</a>
									</li>
									
									
								</ul>
							</nav>
						</div>
						<!-- End Sidebar Menu-->
					</div>
				</div>
				<!-- End Sidebar -->
				</div>
				</div>
				
				
				
				
				
<div id="page" >				
<section id="page-content">
<div id="Inquire-two">
	<form id="searchFrom">
		<div class="input-group">
			<label for="menu_name">文件名称：</label>
			<input id="fileName" name="fileName" usemap="{'logic':'and','compare':'like'}" placeholder="请输入文件名称" />
		
			<span class="input-group-btn">
				<button type="button" class="btn btn-zdy search" id="search">查询</button>
			</span>
		</div>
	</form>
	<div>
	<p class="send"><button  class="btn btn-zdy" data-toggle="modal" data-target="#addcontent">上传文件</button></p>
	
		<table class="table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th>序号</th>
					<th>文件名称</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody id="mytable">

			</tbody>
		</table>
	</div>
</div>
</section>

<div class="modal fade" id="addcontent" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="ModalLabel">上传附件</h4>
			</div>
			
			<form id="formId" enctype="multipart/form-data">
			<div class="modal-body">
				<input type="file" name="detail" multiple="multiple">
					<!-- 
					<form class="form-horizontal" role="form">
					<div class="form-group">
						<label for="contentname" class="col-sm-3 control-label">内容位名称1:</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="contentname" >
						</div>
					</div>
					<div class="form-group">
						<label for="mname1" class="col-sm-3 control-label">内容位位置:</label>
						<div class="col-sm-4">
							<select name="" id="mname1" style="height:33px;width:100%;border-color:#e3e6f3;">
								<option value="1">请选择..</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label for="description" class="col-sm-3 control-label">内容位描述:</label>
						<div class="col-sm-6">
							<textarea  class="form-control" id="description" >
								</textarea>
						</div>
					</div>
					<div class="form-group">
						<label for="contentname1" class="col-sm-3 control-label">内容位名称2:</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="contentname1" >
						</div>
					</div>
					<div class="form-group">
						<label for="" class="col-sm-3 control-label">内容位位置:</label>
						<div class="col-sm-4">
							<select name="" id="" style="height:33px;width:100%;border-color:#e3e6f3;">
								<option value="1">请选择..</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label for="description2" class="col-sm-3 control-label">内容位描述:</label>
						<div class="col-sm-6">
							<textarea  class="form-control" id="description2" >
								</textarea>
						</div>
					</div>
					<div class="form-group">
						<label for="check" class="col-sm-3 control-label" style="padding-top:0;">前台是否显示:</label>
							<input type="checkbox" id="check"/>

					</div>
				</form> -->
			</div>
			<div class="modal-footer ">
				<button type="button" class="btn btn-zdy" id="submit">确定</button>
				<button type="button" class="btn btn-zdy" data-dismiss="modal" id="miss">取消</button>
			</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
</div>
</body>


	<script type="text/javascript">
//查询按钮绑定点击事件
CUI.use([ 'ajaxform', 'utils', 'layer' ], function($ajax, $utils,$layer) {
	return {
		initialize : function() {
			//页面加载后执行
			pageSearch(1);
			$("#search").on("click",function() {
				pageSearch(1);
			});
			/* $("#submit").on("click",function() {
				uploadFile();
			}); */
			_this = this;
			_this.uploadFile();
		},
		uploadFile : function() {
			new CuiAjaxForm($('#formId'), {
				submitSelector : $('#submit'),
				action : '../../updownload/upload',
				beforeEvent : function(formData, jqForm, options) {
					$.insertDynamicDataForTheForm(formData,
							jqForm, options, 'jdbcTemplateName', 'mysqlTemplate');
					$.insertDynamicDataForTheForm(formData,
							jqForm, options, 'pFile', 'file');
					$.insertDynamicDataForTheForm(formData,
							jqForm, options, 'pKey', 'addFile');
					return true;
				},
				callbackEvent : function(result) {
					if (result.status == 'success') {
						alert('上传成功!');
						//pageSearch(1);
						_this.uploadFile();// 绑定上传功能，否则上传点击一次后就无法再使用
						$("#miss").click();
						_this.pageSearch(1);
					}
				}
			});
		}
	}
});

// 分页查询
function pageSearch(pageNo) {
	var pageSize = 6;
	$.asyncRequest({
		url : '../../member/pageSearch',
		data : $.extend({}, {
			"jdbcTemplateName" : "mysqlTemplate",
			"pFile" : "file",
			"pKey" : "filelist",
			"type" : "mysql",
			"pageNo" : pageNo,
			"pageSize" : pageSize,
			"order" : ""
		}, 
		$('#searchFrom').buildQueryInfo(), true),
		event : function(result) {
			if (result.status === 'success') {
				//后台返回的结果集，格式:
				var pageSource = result.listInfo;
				//下面写你的任何业务
				//alert(JSON.stringify(pageSource));
				$("#mytable").html("");// 清空
				$(pageSource.list).each(
					function(index, element) {
						var ind = parseInt(index) + 1;
						$("#mytable").append(
								"<tr><td>"+ind
								+ "</td><td>"
								+ element.filename
								+"</td><td>"
								/* + "<a href=\"javascript:void(0)\" data-toggle=\"modal\" data-target=\"#moodel\" onclick=\"kan('"
								+ element.id
								+ "')\">查看</a> | <a href=\"javascript:void(0)\" data-toggle=\"modal\" data-target=\"#ee\" onclick=\"edit('"
								+ element.id
								+ "')\">编辑</a> | <a href=\"javascript:void(0)\" onclick=\"del('"
								+ element.id
								+ "')\">删除</a>" */
								
								
								+ "<a href=\"javascript:void(0)\" onclick=\"deletefile("
								+ "'" + element.id +"'" + ")\">"
								+ "删除</a>"
								+ " | <a href=\"javascript:void(0)\" onclick=\"downloadfile("
								+ "'" + element.filenewname +"'" + ","
								+ "'" + element.filename + "'" + ","
								+ "'" + element.filesuffix + "'" + ")\">"
								+ "下载</a>"
								+ "</td></tr>"
								);
					});
				$("#mytable").append("<tr><td colspan=\"8\" id=\"pager\"></td></tr>");
				//创建分页
				var target = $('#pager');
				pageClick(pageSource.pageNo, pageSource.total,target,pageSize);
			}
		},
	});
}

// 存储的文件名，原文件名，后缀
function downloadfile(filenewname,filename,filesuffix) {//
	window.location.href = "../../updownload/download?storeName="+filenewname+filesuffix+"&downloadName="+filename;
}
/* function deletefile(id) {
	$.ajax({
		url : '../../member/formProcessing',
		type : "post",
		data : {
			    "jdbcTemplateName":"mysqlTemplate",
				"pFile":"file",
				"pKey":"deleteFile",
				"id":id
		},
		dataType : 'json',
		async :true,
		success : function(result) {
			if (result.status === 'success') {
					console.log(result.status);
			}
		},
		error : function(XMLHttpRequest, textStatus, errorThrown) {}
	});
} */

function deletefile(id) {
	if (confirm("确认删除吗")) {
		$.ajax({
			url : "../../member/formProcessing",
			data : {
				"jdbcTemplateName" : "mysqlTemplate",
				"pFile" : "file",
				"pKey" : "deleteFile",
				"id" : id
			},
			dataType : "json",
			type : 'post',
			async : false,
			success : function(result) {
				if (result.status === 'success') {
					alert("删除成功!");
					pageSearch(1);
				}
			}
		})
	} else {
		return;
	}
}
	</script>
</html>